# AUTOGENERATED! DO NOT EDIT! File to edit: ../../../pts/mod/cmds/07_include_repo.pct.py.

# %% top_export
from pathlib import Path

from repoyard.config import get_config
from repoyard import const

async def include_repo(
    config_path: Path,
    repo_index_name: str,
    soft_interruption_enabled: bool = True,
):
    """
    """
    
    # AUTOGENERATED! DO NOT EDIT! File to edit: ../../../pts/mod/cmds/07_include_repo.pct.py.
    
    # %% auto 0
    __all__ = ['config', 'repoyard_meta', 'repo_meta']
    
    # %% ../../../pts/mod/cmds/07_include_repo.pct.py 10
    config = get_config(config_path)
    
    # %% ../../../pts/mod/cmds/07_include_repo.pct.py 13
    from .._models import get_repoyard_meta
    repoyard_meta = get_repoyard_meta(config)
    
    if repo_index_name not in repoyard_meta.by_index_name:
        raise ValueError(f"Repo '{repo_index_name}' does not exist.")
    
    repo_meta = repoyard_meta.by_index_name[repo_index_name]
    
    if repo_meta.check_included(config):
        raise ValueError(f"Repo '{repo_index_name}' is already included.")
    
    # %% ../../../pts/mod/cmds/07_include_repo.pct.py 15
    from . import sync_repo
    from .._models import RepoPart
    from .._utils.sync_helper import sync_helper, SyncSetting, SyncDirection
    
    # First force sync the data
    await sync_repo(
        config_path=config_path,
        repo_index_name=repo_index_name,
        sync_direction=SyncDirection.PULL,
        sync_setting=SyncSetting.FORCE,
        sync_choices=[RepoPart.DATA],
        soft_interruption_enabled=soft_interruption_enabled,
    )
    
    # Then sync the rest
    await sync_repo(
        config_path=config_path,
        repo_index_name=repo_index_name,
        sync_direction=None,
        sync_setting=SyncSetting.CAREFUL,
        sync_choices=[RepoPart.META, RepoPart.CONF],
        soft_interruption_enabled=soft_interruption_enabled,
    );