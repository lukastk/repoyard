# AUTOGENERATED! DO NOT EDIT! File to edit: pts/tests/unit/config/test_group_config.pct.py

__all__ = ['TestBoxGroupConfigConstruction', 'TestBoxGroupTitleMode', 'TestGroupConfigEdgeCases', 'TestGroupConfigStrictMode', 'TestVirtualBoxGroupConfigConstruction', 'TestVirtualBoxGroupIsInGroup']

# %% pts/tests/unit/config/test_group_config.pct.py 2
import pytest
from pydantic import ValidationError

from boxyard.config import BoxGroupConfig, VirtualBoxGroupConfig, BoxGroupTitleMode


# ============================================================================
# Tests for BoxGroupTitleMode enum
# ============================================================================

# %% pts/tests/unit/config/test_group_config.pct.py 3
class TestBoxGroupTitleMode:
    """Tests for the BoxGroupTitleMode enum."""

    def test_title_mode_values(self):
        """BoxGroupTitleMode has correct values."""
        assert BoxGroupTitleMode.INDEX_NAME.value == "index_name"
        assert BoxGroupTitleMode.DATETIME_AND_NAME.value == "datetime_and_name"
        assert BoxGroupTitleMode.NAME.value == "name"

    def test_title_mode_count(self):
        """There are exactly 3 title modes."""
        assert len(BoxGroupTitleMode) == 3


# ============================================================================
# Tests for BoxGroupConfig construction
# ============================================================================

# %% pts/tests/unit/config/test_group_config.pct.py 4
class TestBoxGroupConfigConstruction:
    """Tests for BoxGroupConfig construction."""

    def test_default_values(self):
        """BoxGroupConfig has correct defaults."""
        config = BoxGroupConfig()

        assert config.symlink_name is None
        assert config.box_title_mode == BoxGroupTitleMode.INDEX_NAME
        assert config.unique_box_names is False

    def test_custom_symlink_name(self):
        """Custom symlink_name can be set."""
        config = BoxGroupConfig(symlink_name="my-custom-name")

        assert config.symlink_name == "my-custom-name"

    def test_title_mode_index_name(self):
        """INDEX_NAME title mode can be set."""
        config = BoxGroupConfig(box_title_mode="index_name")

        assert config.box_title_mode == BoxGroupTitleMode.INDEX_NAME

    def test_title_mode_datetime_and_name(self):
        """DATETIME_AND_NAME title mode can be set."""
        config = BoxGroupConfig(box_title_mode="datetime_and_name")

        assert config.box_title_mode == BoxGroupTitleMode.DATETIME_AND_NAME

    def test_title_mode_name(self):
        """NAME title mode can be set."""
        config = BoxGroupConfig(box_title_mode="name")

        assert config.box_title_mode == BoxGroupTitleMode.NAME

    def test_title_mode_from_enum(self):
        """Title mode can be set from enum directly."""
        config = BoxGroupConfig(box_title_mode=BoxGroupTitleMode.NAME)

        assert config.box_title_mode == BoxGroupTitleMode.NAME

    def test_invalid_title_mode(self):
        """Invalid title mode raises error."""
        with pytest.raises(ValidationError):
            BoxGroupConfig(box_title_mode="invalid")

    def test_unique_box_names_true(self):
        """unique_box_names can be set to True."""
        config = BoxGroupConfig(unique_box_names=True)

        assert config.unique_box_names is True

    def test_full_config(self):
        """Full config with all options."""
        config = BoxGroupConfig(
            symlink_name="projects",
            box_title_mode="name",
            unique_box_names=True,
        )

        assert config.symlink_name == "projects"
        assert config.box_title_mode == BoxGroupTitleMode.NAME
        assert config.unique_box_names is True


# ============================================================================
# Tests for VirtualBoxGroupConfig construction
# ============================================================================

# %% pts/tests/unit/config/test_group_config.pct.py 5
class TestVirtualBoxGroupConfigConstruction:
    """Tests for VirtualBoxGroupConfig construction."""

    def test_minimal_config(self):
        """Minimal VirtualBoxGroupConfig with just filter_expr."""
        config = VirtualBoxGroupConfig(filter_expr="backend")

        assert config.filter_expr == "backend"
        assert config.symlink_name is None
        assert config.box_title_mode == BoxGroupTitleMode.INDEX_NAME

    def test_full_config(self):
        """Full VirtualBoxGroupConfig with all options."""
        config = VirtualBoxGroupConfig(
            symlink_name="active-projects",
            box_title_mode="datetime_and_name",
            filter_expr="backend AND NOT archived",
        )

        assert config.symlink_name == "active-projects"
        assert config.box_title_mode == BoxGroupTitleMode.DATETIME_AND_NAME
        assert config.filter_expr == "backend AND NOT archived"

    def test_filter_expr_required(self):
        """filter_expr is required."""
        with pytest.raises(ValidationError):
            VirtualBoxGroupConfig()


# ============================================================================
# Tests for VirtualBoxGroupConfig.is_in_group
# ============================================================================

# %% pts/tests/unit/config/test_group_config.pct.py 6
class TestVirtualBoxGroupIsInGroup:
    """Tests for VirtualBoxGroupConfig.is_in_group method."""

    def test_simple_match(self):
        """Simple group name matches."""
        config = VirtualBoxGroupConfig(filter_expr="backend")

        assert config.is_in_group(["backend", "api"]) is True
        assert config.is_in_group(["frontend"]) is False

    def test_and_expression(self):
        """AND expression works correctly."""
        config = VirtualBoxGroupConfig(filter_expr="backend AND python")

        assert config.is_in_group(["backend", "python"]) is True
        assert config.is_in_group(["backend"]) is False
        assert config.is_in_group(["python"]) is False

    def test_or_expression(self):
        """OR expression works correctly."""
        config = VirtualBoxGroupConfig(filter_expr="backend OR frontend")

        assert config.is_in_group(["backend"]) is True
        assert config.is_in_group(["frontend"]) is True
        assert config.is_in_group(["backend", "frontend"]) is True
        assert config.is_in_group(["mobile"]) is False

    def test_not_expression(self):
        """NOT expression works correctly."""
        config = VirtualBoxGroupConfig(filter_expr="NOT archived")

        assert config.is_in_group(["backend"]) is True
        assert config.is_in_group(["archived"]) is False
        assert config.is_in_group(["backend", "archived"]) is False

    def test_complex_expression(self):
        """Complex expression with multiple operators."""
        config = VirtualBoxGroupConfig(
            filter_expr="(backend OR frontend) AND NOT archived"
        )

        assert config.is_in_group(["backend"]) is True
        assert config.is_in_group(["frontend"]) is True
        assert config.is_in_group(["backend", "archived"]) is False
        assert config.is_in_group(["mobile"]) is False

    def test_filter_func_cached(self):
        """Filter function is cached after first call."""
        config = VirtualBoxGroupConfig(filter_expr="backend")

        # First call
        config.is_in_group(["backend"])

        # Verify _filter_func is set
        assert hasattr(config, "_filter_func")

        # Second call should use cached function
        result = config.is_in_group(["backend"])
        assert result is True

    def test_with_empty_groups(self):
        """is_in_group works with empty group list."""
        config = VirtualBoxGroupConfig(filter_expr="backend")

        assert config.is_in_group([]) is False

    def test_with_set_input(self):
        """is_in_group accepts sets."""
        config = VirtualBoxGroupConfig(filter_expr="backend")

        # The underlying filter function should handle both lists and sets
        assert config.is_in_group({"backend", "api"}) is True


# ============================================================================
# Tests for strict mode
# ============================================================================

# %% pts/tests/unit/config/test_group_config.pct.py 7
class TestGroupConfigStrictMode:
    """Tests for strict mode in group configs."""

    def test_box_group_config_extra_field(self):
        """BoxGroupConfig rejects extra fields."""
        with pytest.raises(ValidationError, match="extra"):
            BoxGroupConfig(
                symlink_name="test",
                unknown_field="value",
            )

    def test_virtual_box_group_config_extra_field(self):
        """VirtualBoxGroupConfig rejects extra fields."""
        with pytest.raises(ValidationError, match="extra"):
            VirtualBoxGroupConfig(
                filter_expr="backend",
                unknown_field="value",
            )


# ============================================================================
# Tests for edge cases
# ============================================================================

# %% pts/tests/unit/config/test_group_config.pct.py 8
class TestGroupConfigEdgeCases:
    """Tests for edge cases in group configs."""

    def test_empty_symlink_name(self):
        """Empty string symlink_name is allowed."""
        config = BoxGroupConfig(symlink_name="")
        assert config.symlink_name == ""

    def test_symlink_name_with_special_chars(self):
        """Symlink names can contain various characters."""
        config = BoxGroupConfig(symlink_name="my-projects_2024")
        assert config.symlink_name == "my-projects_2024"

    def test_filter_expr_whitespace(self):
        """Filter expressions with extra whitespace work."""
        config = VirtualBoxGroupConfig(filter_expr="  backend  AND  api  ")

        assert config.is_in_group(["backend", "api"]) is True

    def test_filter_expr_case_insensitive_operators(self):
        """Filter expressions work with different operator cases."""
        config = VirtualBoxGroupConfig(filter_expr="backend and api")

        assert config.is_in_group(["backend", "api"]) is True

    def test_multiple_virtual_groups_independent(self):
        """Multiple VirtualBoxGroupConfig instances are independent."""
        config1 = VirtualBoxGroupConfig(filter_expr="backend")
        config2 = VirtualBoxGroupConfig(filter_expr="frontend")

        assert config1.is_in_group(["backend"]) is True
        assert config1.is_in_group(["frontend"]) is False
        assert config2.is_in_group(["backend"]) is False
        assert config2.is_in_group(["frontend"]) is True
